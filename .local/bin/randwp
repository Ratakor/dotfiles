#!/bin/sh
# set a random wallpaper
# to ignore a folder or a file put it in IGNORE after the - like below
# IGNORE=${IGNORE-file1|folder|file2}
# IGNORE can be an env variable (useful for lf)

WPDIR=${1:-$XDG_DATA_HOME/wallpapers}
IGNORE=${IGNORE-nsfw}
ALL=$(find "$WPDIR" -type f ! -path '*/.git*' ! -name 'README.md')

searchwp() {
	wp=$(printf '%s' "$ALL" | shuf -n 1)
	if [ -n "$IGNORE" ]; then
		while printf '%s' "$wp" | grep -q -E "$IGNORE" ; do
			wp=$(printf '%s' "$ALL" | shuf -n 1)
		done
	fi
}

# 1 screen with hsetroot
#searchwp
#hsetroot -cover "$wp" 1>/dev/null

# multiple screens with xwallpaper
for output in $(xrandr | awk '$2=="connected" {print $1 "\n"}'); do
	searchwp
	xwallpaper --output "$output" --zoom "$wp"
done
