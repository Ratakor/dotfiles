#!/bin/sh
# set a random wallpaper for multiple screen with xwallpaper
# to ignore a folder or a file put it in IGNORE like "file1|folder|file2"

WPDIR="${1:-$XDG_DATA_HOME/wallpapers}"
IGNORE="nsfw"
ALL="$(find "$WPDIR" -type f ! -path '*/.git*' ! -name 'README.md')"

searchwp() {
	wp="$(printf '%s' "$ALL" | shuf -n 1)"
	while printf '%s' "$wp" | grep -q -E "$IGNORE" ; do
		wp="$(printf '%s' "$ALL" | shuf -n 1 -)"
	done
}


for output in $(xrandr | awk '$2=="connected" {print $1 "\n"}'); do
	searchwp
	xwallpaper --output "$output" --zoom "$wp"
done
