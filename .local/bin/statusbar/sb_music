#!/bin/sh
[ $(pgrep music) ] 2> /dev/null && exit

ICON_PAUSE=''
ICON_PLAY=''
PAUSE=$(echo '{ "command": ["get_property_string", "pause"] }' | socat - /tmp/mpvsocket 2> /dev/null | jq ".data" | sed 's/"//g')
TITLE=$(echo '{ "command": ["get_property", "filtered-metadata"] }' | socat - /tmp/mpvsocket 2> /dev/null | jq ".data.Title" | sed 's/"//g')

[ "$TITLE" = "null" ] && TITLE=$(yt-dlp --skip-download --get-title $(echo '{ "command": ["get_property", "path"] }' | socat - /tmp/mpvsocket 2> /dev/null | jq ".data" | sed 's/"//'))

if [ "$PAUSE" = "yes" ]; then
    printf "$ICON_PAUSE $TITLE\n"
elif [ "$PAUSE" = "no" ]; then
    printf "$ICON_PLAY $TITLE\n"
fi
