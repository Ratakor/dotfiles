#!/bin/sh
# install package from AUR
[ -z "$1" ] && printf "You must run this command with an argument\n" && exit
[ -n "$(pacman -Qq | grep -x $1)" ] && printf "$1 is already installed\n" && exit

ROOTCMD="${ROOTCMD:-$(command -v doas || command -v sudo)}"
CACHE="${XDG_CACHE_HOME:-$HOME/.cache}/aur"

mkdir -p "$CACHE"
rm -rf "$CACHE/$1"
git clone "https://aur.archlinux.org/$1.git" "$CACHE/$1"
cd "$CACHE/$1" && makepkg -si
rm -rf "$CACHE/$1"
[ -n "$(pacman -Qqdt)" ] && printf "Type your password to remove orphaned packages\n" &&
    "$ROOTCMD" pacman -Rns $(pacman -Qqdt)
