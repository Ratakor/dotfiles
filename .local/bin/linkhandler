#!/bin/sh
#Handle links when a program calls it, pretty much just newsboat

# If no url given. Opens browser. For using script as $BROWSER.
[ -z "$1" ] && { "$BROWSER"; exit; }

case "$1" in
	*mkv|*webm|*mp4|*youtube.com/watch*|*youtube.com/playlist*|*youtu.be*|*invidious*/watch*|*invidious*/playlist*|*inv*/watch*)
		setsid -f mpv -quiet --ytdl-format=22 --loop "$1" >/dev/null 2>&1 ;;
	*png|*jpg|*jpe|*jpeg|*gif)
		curl -sL "$1" > "/tmp/$(echo "$1" | sed "s/.*\///;s/%20/ /g")" && sxiv -a "/tmp/$(echo "$1" | sed "s/.*\///;s/%20/ /g")"  >/dev/null 2>&1 & ;;
	*pdf|*cbz|*cbr)
		curl -sL "$1" > "/tmp/$(echo "$1" | sed "s/.*\///;s/%20/ /g")" && zathura "/tmp/$(echo "$1" | sed "s/.*\///;s/%20/ /g")"  >/dev/null 2>&1 & ;;
	*mp3|*flac|*opus|*mp3?source*)
		setsid -f "$TERMINAL" -e music "$1" >/dev/null 2>&1 ;;
	*wp.com/stonetoss.com*)
		URL=$(echo "$1" | sed "s/?resize=150%2C150&ssl=1//") &&
		curl -sL "$URL" > "/tmp/$(echo "$URL" | sed "s/.*\///;s/%20/ /g")" && sxiv -a "/tmp/$(echo "$URL" | sed "s/.*\///;s/%20/ /g")"  >/dev/null 2>&1 & ;;
	*)
		[ -f "$1" ] && setsid -f "$TERMINAL" -e "$EDITOR" "$1" >/dev/null 2>&1 || setsid -f "$BROWSER" "$1" >/dev/null 2>&1
esac
