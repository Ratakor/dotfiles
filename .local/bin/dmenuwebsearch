#!/bin/sh
# websearch with dmenu, need shuf and curl

if [ ! -f "/tmp/instances" ]; then
	curl -s "https://librex.ratakor.com/instances.json" > /tmp/instances.json

	strip() {
		tmp="${1##"              \"clearnet\": \""}"
		printf '%s\n' "${tmp%%"\","}"
	}

	while IFS= read -r line || [ -n "$line" ]; do
		case $line in
		*"https"*)
			strip "$line" >> /tmp/instances ;;
		esac
	done < /tmp/instances.json
fi

query="$(printf "" | dmenu -p "Search:" -l 0)"
instance="$(shuf -n 1 /tmp/instances)"

[ -n "$query" ] && "$BROWSER" "${instance}search.php?q=${query}&t=0" 2> /dev/null
