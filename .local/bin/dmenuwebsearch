#!/bin/bash
# websearch with dmenu

#SEARCH_ENGINE="https://librex.ratakor.com/search.php?q="
#QUERY=$(printf ""| dmenu -p "Search:" -l 0)
#[ -n "$QUERY" ] && "$BROWSER" "${SEARCH_ENGINE}${QUERY}&t=0" 2> /dev/null

# Choose a random instance
INSTANCES=$(curl -s "https://librex.ratakor.com/instances.json" | awk '/https/ { print $2 }' | sed 's/,//' | tr '\n' ' ' | sed 's/\"//g')
NUM_INSTANCES=$(printf "$INSTANCES" | wc -w)
RAND=$((RANDOM%$NUM_INSTANCES))
i=0
for val in $INSTANCES; do
	[ "$i" = "$RAND" ] && SEARCH_ENGINE=$val
	i=$((i+1))
done

QUERY=$(printf "%s"| dmenu -p "Search:" -l 0)
[ -n "$QUERY" ] && "$BROWSER" "${SEARCH_ENGINE}search.php?q=${QUERY}&t=0" 2> /dev/null
